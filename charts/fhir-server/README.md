# fhir-server

[Microsoft FHIR Server](https://github.com/microsoft/fhir-server) - Helm chart for deploying the Microsoft FHIR Server for Azure.

## TL;DR;

```sh
$ helm repo add chgl https://chgl.github.io/charts
$ helm repo update
$ helm install fhir-server chgl/fhir-server -n fhir
```

## Introduction

This chart deploys the Microsoft FHIR Server for Azure. on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Prerequisites

- Kubernetes v1.16+
- Helm v3

## Installing the Chart

To install the chart with the release name `fhir-server`:

```sh
$ helm install fhir-server chgl/fhir-server -n fhir
```

The command deploys the Microsoft FHIR Server for Azure. on the Kubernetes cluster in the default configuration. The [configuration](#configuration) section lists the parameters that can be configured during installation.

> **Tip**: List all releases using `helm list`

## Uninstalling the Chart

To uninstall/delete the `fhir-server`:

```console
$ helm delete fhir-server -n fhir
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

## Configuration

The following table lists the configurable parameters of the `fhir-server` chart and their default values.

| Parameter                                                      | Description                                                                                                                                                                                                                               | Default                                                     |
| -------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
| replicaCount                                                   |                                                                                                                                                                                                                                           | <code>1</code>                                              |
| imagePullSecrets                                               |                                                                                                                                                                                                                                           | <code>[]</code>                                             |
| nameOverride                                                   |                                                                                                                                                                                                                                           | <code>""</code>                                             |
| fullnameOverride                                               |                                                                                                                                                                                                                                           | <code>""</code>                                             |
| podIdentity.enabled                                            |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| export.enabled                                                 |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| export.blobStorageUri                                          |                                                                                                                                                                                                                                           | <code>https://mystorageaccount.blob.core.windows.net</code> |
| podSecurityContext                                             |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| service.type                                                   |                                                                                                                                                                                                                                           | <code>ClusterIP</code>                                      |
| service.port                                                   |                                                                                                                                                                                                                                           | <code>80</code>                                             |
| database.dataStore                                             | options: ExistingSqlServer, SqlServer, SqlContainer, CosmosDb                                                                                                                                                                             | <code>"SqlServer"</code>                                    |
| database.resourceGroup                                         |                                                                                                                                                                                                                                           | <code>""</code>                                             |
| database.location                                              |                                                                                                                                                                                                                                           | <code>""</code>                                             |
| database.sql.edition                                           | 0: Basic 1: Business 2: BusinessCritical 3: DataWarehouse 4: Free 5: GeneralPurpose 6: Hyperscale 7: Premium More at https://godoc.org/github.com/Azure/azure-sdk-for-go/services/preview/sql/mgmt/2015-05-01-preview/sql#DatabaseEdition | <code>5</code>                                              |
| database.sql.maxPoolSize                                       |                                                                                                                                                                                                                                           | <code>100</code>                                            |
| database.sql.schema.automaticUpdatesEnabled                    |                                                                                                                                                                                                                                           | <code>true</code>                                           |
| database.cosmosDb.initialCollectionThroughput                  |                                                                                                                                                                                                                                           | <code>"400"</code>                                          |
| database.sqlContainer.acceptEula                               | Accept EULA when deploying with --set database.sqlContainer.acceptEula="Y"                                                                                                                                                                | <code>"n"</code>                                            |
| database.sqlContainer.edition                                  |                                                                                                                                                                                                                                           | <code>"Developer"</code>                                    |
| database.sqlContainer.image.registry                           |                                                                                                                                                                                                                                           | <code>mcr.microsoft.com</code>                              |
| database.sqlContainer.image.repository                         |                                                                                                                                                                                                                                           | <code>mssql/server</code>                                   |
| database.sqlContainer.image.tag                                |                                                                                                                                                                                                                                           | <code>2019-latest</code>                                    |
| database.sqlContainer.image.pullPolicy                         |                                                                                                                                                                                                                                           | <code>IfNotPresent</code>                                   |
| database.sqlContainer.replicaCount                             |                                                                                                                                                                                                                                           | <code>1</code>                                              |
| database.sqlContainer.port                                     |                                                                                                                                                                                                                                           | <code>1433</code>                                           |
| database.sqlContainer.databaseName                             |                                                                                                                                                                                                                                           | <code>FHIR</code>                                           |
| database.sqlContainer.userName                                 |                                                                                                                                                                                                                                           | <code>sa</code>                                             |
| database.sqlContainer.resources                                |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| database.sqlContainer.persistence.storageClass                 |                                                                                                                                                                                                                                           | <code>""</code>                                             |
| database.sqlContainer.persistence.size                         |                                                                                                                                                                                                                                           | <code>8Gi</code>                                            |
| database.sqlContainer.persistence.annotations                  |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| database.sqlContainer.securityContext.allowPrivilegeEscalation |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| database.sqlContainer.podSecurityContext.runAsUser             | mssql container has user mssql defined with id 10001                                                                                                                                                                                      | <code>10001</code>                                          |
| database.sqlContainer.podSecurityContext.runAsGroup            |                                                                                                                                                                                                                                           | <code>10001</code>                                          |
| database.sqlContainer.podSecurityContext.fsGroup               |                                                                                                                                                                                                                                           | <code>10001</code>                                          |
| database.existingSqlServer.userName                            |                                                                                                                                                                                                                                           | <code>sa</code>                                             |
| database.existingSqlServer.databaseName                        |                                                                                                                                                                                                                                           | <code>FHIR</code>                                           |
| database.existingSqlServer.serverName                          |                                                                                                                                                                                                                                           | <code>mymssql-mssql-linux.default</code>                    |
| database.existingSqlServer.password                            |                                                                                                                                                                                                                                           | <code>fhir</code>                                           |
| database.existingSqlServer.existingSecret                      | name of a pre-created secret to retrieve the SQL Server's password. the secret must have a key named `DATABASEPASSWORD` with the password as its value.                                                                                   | <code>""</code>                                             |
| database.existingSqlServer.port                                |                                                                                                                                                                                                                                           | <code>1433</code>                                           |
| database.connectionTimeoutSeconds                              | sets the connection timeout (`Connection Timeout` parameter of the connection string)                                                                                                                                                     | <code>30</code>                                             |
| appInsights.secretKey                                          |                                                                                                                                                                                                                                           | <code>"instrumentationKey"</code>                           |
| serviceMonitor.enabled                                         |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| serviceMonitor.port                                            |                                                                                                                                                                                                                                           | <code>1234</code>                                           |
| serviceMonitor.labels                                          |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| serviceMonitor.interval                                        | prometheus: monitor                                                                                                                                                                                                                       | <code>30s</code>                                            |
| serviceMonitor.dotnetRuntimeMetrics                            |                                                                                                                                                                                                                                           | <code>true</code>                                           |
| serviceMonitor.httpMetrics                                     |                                                                                                                                                                                                                                           | <code>true</code>                                           |
| serviceMonitor.systemMetrics                                   |                                                                                                                                                                                                                                           | <code>true</code>                                           |
| security.enabled                                               |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| security.enableAadSmartOnFhirProxy                             |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| security.authority                                             |                                                                                                                                                                                                                                           | <code>null</code>                                           |
| security.audience                                              |                                                                                                                                                                                                                                           | <code>null</code>                                           |
| ingress.enabled                                                |                                                                                                                                                                                                                                           | <code>false</code>                                          |
| ingress.annotations                                            |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| ingress.tls                                                    |                                                                                                                                                                                                                                           | <code>[]</code>                                             |
| resources                                                      |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| nodeSelector                                                   |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| tolerations                                                    |                                                                                                                                                                                                                                           | <code>[]</code>                                             |
| affinity                                                       |                                                                                                                                                                                                                                           | <code>{}</code>                                             |
| extraEnv                                                       | add additional environment variables                                                                                                                                                                                                      | <code>[]</code>                                             |

Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example:

```console
$ helm install fhir-server chgl/fhir-server -n fhir --set replicaCount=1
```

Alternatively, a YAML file that specifies the values for the parameters can be provided while
installing the chart. For example:

```sh
$ helm install fhir-server chgl/fhir-server -n fhir --values values.yaml
```
