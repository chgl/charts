# vfps

![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square)

> **:exclamation: This Helm Chart is deprecated!**

A Helm chart for deploying VFPS, a very fast and resource-efficient pseudonym service.

**Homepage:** <https://github.com/chgl/vfps>

## Installation

```sh
helm repo add chgl https://chgl.github.io/charts
helm repo update
helm install --create-namespace vfps chgl/vfps -n vfps
```

> **Warning**
> By default, the included [PostgreSQL Helm chart](https://github.com/bitnami/charts/tree/master/bitnami/postgresql#upgrading)
> auto-generates a random password for the database which may cause problems when upgrading the chart (see [here for details](https://github.com/bitnami/charts/tree/master/bitnami/postgresql#upgrading)).

## Usage

```sh
kubectl run -i --tty --rm debug --image=ghcr.io/chgl/vfps-grpc-utils:latest --restart=Never -- bash

nobody@debug:/$ grpcurl \
  -plaintext \
  -import-path=/tmp/protos/ \
  -proto=Protos/vfps/api/v1/namespaces.proto \
  -d '{"name": "test", "pseudonymGenerationMethod": "PSEUDONYM_GENERATION_METHOD_SECURE_RANDOM_BASE64URL_ENCODED", "pseudonymLength": 32}' \
  vfps-headless:8081 \
  vfps.api.v1.NamespaceService/Create

nobody@debug:/$ ghz --duration=1m \
  --connections=3 \
  --lb-strategy=round_robin \
  --cpus=3 \
  --insecure \
  --import-paths=/tmp/protos/ \
  --proto=Protos/vfps/api/v1/pseudonyms.proto \
  --call=vfps.api.v1.PseudonymService/Create \
  -d '{"originalValue": "{{ randomString 32 }}", "namespace": "test"}' \
  dns:///vfps-headless:8081
```

## Values

| Key                                           | Type   | Default                                                                                                           | Description                                                                                                                                                                                                                                                                                                                               |
| --------------------------------------------- | ------ | ----------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| affinity                                      | object | `{}`                                                                                                              | pod affinity                                                                                                                                                                                                                                                                                                                              |
| autoscaling.enabled                           | bool   | `false`                                                                                                           | enable horizontal pod autoscaling                                                                                                                                                                                                                                                                                                         |
| autoscaling.maxReplicas                       | int    | `5`                                                                                                               | upper limit for the number of pods that can be set by the autoscaler; cannot be smaller than `minReplicas`.                                                                                                                                                                                                                               |
| autoscaling.minReplicas                       | int    | `1`                                                                                                               | minReplicas is the lower limit for the number of replicas to which the autoscaler can scale down. It defaults to 1 pod. minReplicas is allowed to be 0 if the alpha feature gate HPAScaleToZero is enabled and at least one Object or External metric is configured. Scaling is active as long as at least one metric value is available. |
| autoscaling.targetCPUUtilizationPercentage    | int    | `80`                                                                                                              | target average CPU utilization (represented as a percentage of requested CPU) over all the pods; if not specified the default autoscaling policy will be used.                                                                                                                                                                            |
| database.additionalConnectionStringParameters | string | `"Timeout=60;Max Auto Prepare=5;"`                                                                                | additional parameters appended to the connection string                                                                                                                                                                                                                                                                                   |
| database.database                             | string | `"vfps"`                                                                                                          | name of the database inside. If postgresql.enabled=true, then postgresql.postgresqlDatabase is used                                                                                                                                                                                                                                       |
| database.existingSecret                       | string | `""`                                                                                                              | name of an existing secret containing the password to the DB.                                                                                                                                                                                                                                                                             |
| database.existingSecretKey                    | string | `"postgresql-postgres-password"`                                                                                  | name of the key in `webApi.db.existingSecret` to use as the password to the DB.                                                                                                                                                                                                                                                           |
| database.host                                 | string | `"host.example.com"`                                                                                              | database hostname of an external database. Only used if `postgresql.enabled` is set to `false`.                                                                                                                                                                                                                                           |
| database.password                             | string | `"postgres"`                                                                                                      | the database password. Only used if postgresql.enabled=false, otherwise the secret created by the postgresql chart is used                                                                                                                                                                                                                |
| database.port                                 | int    | `5432`                                                                                                            | port used to connect to the postgres DB                                                                                                                                                                                                                                                                                                   |
| database.schema                               | string | `"vfps"`                                                                                                          | schema used for the tables.                                                                                                                                                                                                                                                                                                               |
| database.username                             | string | `"postgres"`                                                                                                      | username used to connect to the DB. Note that this name is currently used even if postgresql.enabled=true                                                                                                                                                                                                                                 |
| extraEnv                                      | list   | `[]`                                                                                                              | extra environment variables to set on the vfps api container                                                                                                                                                                                                                                                                              |
| fullnameOverride                              | string | `""`                                                                                                              | override the full release name                                                                                                                                                                                                                                                                                                            |
| imagePullSecrets                              | list   | `[]`                                                                                                              | image pull secrets used by the main deployment container                                                                                                                                                                                                                                                                                  |
| ingress.annotations                           | object | `{}`                                                                                                              | extra annotations to apply to the Ingress resource                                                                                                                                                                                                                                                                                        |
| ingress.className                             | string | `""`                                                                                                              | ingressClassName to use                                                                                                                                                                                                                                                                                                                   |
| ingress.enabled                               | bool   | `false`                                                                                                           | create an Ingress for the application                                                                                                                                                                                                                                                                                                     |
| ingress.hosts                                 | list   | `[{"host":"vfps.127.0.0.1.nip.io","paths":[{"path":"/","pathType":"ImplementationSpecific","portName":"http"}]}]` | list of ingress hosts                                                                                                                                                                                                                                                                                                                     |
| ingress.tls                                   | list   | `[]`                                                                                                              | TLS configuration                                                                                                                                                                                                                                                                                                                         |
| migrationsJob.enabled                         | bool   | `true`                                                                                                            | whether to enable the database migration job. If enabled, a `ServiceAccount`, `Role`, and `RoleBinding` resources are created which are used by an init container of the main application to wait for the migrations to complete.                                                                                                         |
| migrationsJob.extraEnv                        | list   | `[]`                                                                                                              | extra environment variables to set on the migrations job container                                                                                                                                                                                                                                                                        |
| migrationsJob.restartPolicy                   | string | `"Never"`                                                                                                         | restart policy for the migration job                                                                                                                                                                                                                                                                                                      |
| nameOverride                                  | string | `""`                                                                                                              | override the release name                                                                                                                                                                                                                                                                                                                 |
| nodeSelector                                  | object | `{}`                                                                                                              | pod node selector                                                                                                                                                                                                                                                                                                                         |
| podAnnotations                                | object | `{}`                                                                                                              | annotations to set on the main deployment's pod                                                                                                                                                                                                                                                                                           |
| podDisruptionBudget.enabled                   | bool   | `false`                                                                                                           | create a PodDisruptionBudget resource                                                                                                                                                                                                                                                                                                     |
| podDisruptionBudget.maxUnavailable            | string | `""`                                                                                                              | Maximum unavailable instances; ignored if there is no PodDisruptionBudget                                                                                                                                                                                                                                                                 |
| podDisruptionBudget.minAvailable              | int    | `1`                                                                                                               | Minimum available instances; ignored if there is no PodDisruptionBudget                                                                                                                                                                                                                                                                   |
| podSecurityContext                            | object | `{}`                                                                                                              | the pod security context                                                                                                                                                                                                                                                                                                                  |
| replicaCount                                  | int    | `1`                                                                                                               | number of replicas                                                                                                                                                                                                                                                                                                                        |
| resources                                     | object | `{}`                                                                                                              | resource limits and requests                                                                                                                                                                                                                                                                                                              |
| service.grpcPort                              | int    | `8081`                                                                                                            | the port which supports HTTP2 only, to accept plaintext gRPC calls                                                                                                                                                                                                                                                                        |
| service.port                                  | int    | `8080`                                                                                                            | the port for the main endpoint which supports HTTP1, HTTP2, and HTTP3                                                                                                                                                                                                                                                                     |
| service.type                                  | string | `"ClusterIP"`                                                                                                     | the type of service                                                                                                                                                                                                                                                                                                                       |
| serviceAccount.annotations                    | object | `{}`                                                                                                              | Annotations to add to the service account                                                                                                                                                                                                                                                                                                 |
| serviceAccount.create                         | bool   | `false`                                                                                                           | Specifies whether a service account should be created.                                                                                                                                                                                                                                                                                    |
| serviceAccount.name                           | string | `""`                                                                                                              | The name of the service account to use. If not set and create is true, a name is generated using the fullname template                                                                                                                                                                                                                    |
| serviceMonitor.additionalLabels               | object | `{}`                                                                                                              | additional labels to apply to the ServiceMonitor object, e.g. `release: prometheus`                                                                                                                                                                                                                                                       |
| serviceMonitor.enabled                        | bool   | `false`                                                                                                           | if enabled, creates a ServiceMonitor instance for Prometheus Operator-based monitoring                                                                                                                                                                                                                                                    |
| tolerations                                   | list   | `[]`                                                                                                              | pod tolerations                                                                                                                                                                                                                                                                                                                           |
| topologySpreadConstraints                     | list   | `[]`                                                                                                              | pod topology spread configuration see: <https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/#api>                                                                                                                                                                                                          |

---

Autogenerated from chart metadata using [helm-docs v1.11.0](https://github.com/norwoodj/helm-docs/releases/v1.11.0)
